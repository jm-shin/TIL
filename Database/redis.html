<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis | 개발자 신종민</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Today I Learned">
    
    <link rel="preload" href="/TIL/assets/css/0.styles.13b71ac0.css" as="style"><link rel="preload" href="/TIL/assets/js/app.dc1d7481.js" as="script"><link rel="preload" href="/TIL/assets/js/2.24238b2e.js" as="script"><link rel="preload" href="/TIL/assets/js/16.d2238131.js" as="script"><link rel="prefetch" href="/TIL/assets/js/10.2d1379bb.js"><link rel="prefetch" href="/TIL/assets/js/11.ae4eb815.js"><link rel="prefetch" href="/TIL/assets/js/12.9b97d1f8.js"><link rel="prefetch" href="/TIL/assets/js/13.17092913.js"><link rel="prefetch" href="/TIL/assets/js/14.507a7a1e.js"><link rel="prefetch" href="/TIL/assets/js/15.565546ed.js"><link rel="prefetch" href="/TIL/assets/js/17.a133ce7e.js"><link rel="prefetch" href="/TIL/assets/js/18.f218ead6.js"><link rel="prefetch" href="/TIL/assets/js/19.b67c18ec.js"><link rel="prefetch" href="/TIL/assets/js/20.f56a7fd1.js"><link rel="prefetch" href="/TIL/assets/js/21.aab203c5.js"><link rel="prefetch" href="/TIL/assets/js/22.0f5ee716.js"><link rel="prefetch" href="/TIL/assets/js/23.adebe046.js"><link rel="prefetch" href="/TIL/assets/js/24.8747a99c.js"><link rel="prefetch" href="/TIL/assets/js/25.54b77906.js"><link rel="prefetch" href="/TIL/assets/js/26.a6dae2a7.js"><link rel="prefetch" href="/TIL/assets/js/27.27004f97.js"><link rel="prefetch" href="/TIL/assets/js/28.050b78e1.js"><link rel="prefetch" href="/TIL/assets/js/29.085a91e0.js"><link rel="prefetch" href="/TIL/assets/js/3.7a4b78ab.js"><link rel="prefetch" href="/TIL/assets/js/30.92dfddcd.js"><link rel="prefetch" href="/TIL/assets/js/4.c45a18a4.js"><link rel="prefetch" href="/TIL/assets/js/5.6dbf3872.js"><link rel="prefetch" href="/TIL/assets/js/6.a76351f6.js"><link rel="prefetch" href="/TIL/assets/js/7.4112101f.js"><link rel="prefetch" href="/TIL/assets/js/8.0aaa2330.js"><link rel="prefetch" href="/TIL/assets/js/9.a3d6fec7.js">
    <link rel="stylesheet" href="/TIL/assets/css/0.styles.13b71ac0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/TIL/" class="home-link router-link-active"><img src="https://avatars.githubusercontent.com/u/53161335?v=4" alt="개발자 신종민" class="logo"> <span class="site-name can-hide">개발자 신종민</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/TIL/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/TIL/About/" class="nav-link">
  About
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/TIL/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/TIL/About/" class="nav-link">
  About
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Books</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Database</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/TIL/Database/mongodb.html" class="sidebar-link">MongoDB</a></li><li><a href="/TIL/Database/mysql.html" class="sidebar-link">MySQL</a></li><li><a href="/TIL/Database/redis.html" aria-current="page" class="active sidebar-link">Redis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TIL/Database/redis.html#redis-2" class="sidebar-link">Redis?</a></li><li class="sidebar-sub-header"><a href="/TIL/Database/redis.html#redis-주요-사용처" class="sidebar-link">Redis 주요 사용처</a></li><li class="sidebar-sub-header"><a href="/TIL/Database/redis.html#캐싱-전략" class="sidebar-link">캐싱 전략</a></li><li class="sidebar-sub-header"><a href="/TIL/Database/redis.html#redis-데이터-타입" class="sidebar-link">Redis 데이터 타입</a></li><li class="sidebar-sub-header"><a href="/TIL/Database/redis.html#구현" class="sidebar-link">구현</a></li><li class="sidebar-sub-header"><a href="/TIL/Database/redis.html#카운팅-counting" class="sidebar-link">카운팅(Counting)</a></li><li class="sidebar-sub-header"><a href="/TIL/Database/redis.html#메시징-messaging" class="sidebar-link">메시징(Messaging)</a></li><li class="sidebar-sub-header"><a href="/TIL/Database/redis.html#redis에서-데이터를-영구저장하는-방법" class="sidebar-link">Redis에서 데이터를 영구저장하는 방법?</a></li><li class="sidebar-sub-header"><a href="/TIL/Database/redis.html#rdb-vs-aof-선택-기준" class="sidebar-link">RDB vs AOF 선택 기준</a></li><li class="sidebar-sub-header"><a href="/TIL/Database/redis.html#redis-아키텍처의-종류" class="sidebar-link">Redis 아키텍처의 종류</a></li><li class="sidebar-sub-header"><a href="/TIL/Database/redis.html#사용하지-말아야할-커멘트" class="sidebar-link">사용하지 말아야할 커멘트</a></li><li class="sidebar-sub-header"><a href="/TIL/Database/redis.html#변경하면-장애를-막을-수-있는-기본-설정값" class="sidebar-link">변경하면 장애를 막을 수 있는 기본 설정값</a></li><li class="sidebar-sub-header"><a href="/TIL/Database/redis.html#cache-stamped-현상" class="sidebar-link">Cache Stamped 현상</a></li><li class="sidebar-sub-header"><a href="/TIL/Database/redis.html#maxmemory-값-설정" class="sidebar-link">MaxMemory 값 설정</a></li><li class="sidebar-sub-header"><a href="/TIL/Database/redis.html#memory-관리" class="sidebar-link">Memory 관리</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vuepress</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Front</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ETC</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redis"><a href="#redis" class="header-anchor">#</a> Redis</h1> <h2 id="redis-2"><a href="#redis-2" class="header-anchor">#</a> Redis?</h2> <ul><li>단순한 key-value 구조</li> <li>In-memory 데이터 저장소(RAM)</li> <li>빠른 성능
<ul><li>평균 작업 속도 &lt; 1ms</li> <li>초당 수백만 건의 작업 가능</li></ul></li></ul> <h2 id="redis-주요-사용처"><a href="#redis-주요-사용처" class="header-anchor">#</a> Redis 주요 사용처</h2> <ul><li>캐싱</li> <li>채팅, 메시징, 대기열</li> <li>세션 저장</li> <li>실시간 분석</li> <li>미디어 스트리밍</li> <li>지리 공간 데이터 저장</li> <li>머신 러닝</li> <li>게임 순위표</li></ul> <h2 id="캐싱-전략"><a href="#캐싱-전략" class="header-anchor">#</a> 캐싱 전략</h2> <ul><li>읽기 전략
<ul><li>Look-Aside(Lazy Loading)</li></ul></li> <li>쓰기 전략
<ul><li>Write-Around</li> <li>Write-Through</li></ul></li></ul> <h2 id="redis-데이터-타입"><a href="#redis-데이터-타입" class="header-anchor">#</a> Redis 데이터 타입</h2> <ul><li>String</li> <li>Bitmaps</li> <li>Lists</li> <li>Hashes</li> <li>Sets</li> <li>Sorted Sets</li> <li>HyperLogLogs</li> <li>Streams</li></ul> <h2 id="구현"><a href="#구현" class="header-anchor">#</a> 구현</h2> <h2 id="카운팅-counting"><a href="#카운팅-counting" class="header-anchor">#</a> 카운팅(Counting)</h2> <p><strong>String</strong></p> <ul><li>단순 증감 연산</li> <li>INCR/ INCRBY / INCRBYFLOAT / HINCRBY / HICRBYFLOAT / ZINCRBY</li></ul> <p><strong>Bits</strong></p> <ul><li>데이터 저장공간 절약</li> <li>정수로 된 데이터만 카운팅 가능</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>redis <span class="token operator">&gt;</span> SETBIT visitors:20220122 <span class="token number">3</span> <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>

redis <span class="token operator">&gt;</span> SETBIT visitors:20220122 <span class="token number">6</span> <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>

redis <span class="token operator">&gt;</span> BITCOUNT visitors:20220122
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
</code></pre></div><p><strong>HyperLogLogs</strong></p> <ul><li>대용량 데이터를 카운팅 할 때 적절</li> <li>set과 비슷하지만 저장되는 용량은 매우 작음</li> <li>저장된 데이터는 다시 확인할 수 없음</li> <li>크롤링한 데이터 갯수 카운팅 등</li></ul> <h2 id="메시징-messaging"><a href="#메시징-messaging" class="header-anchor">#</a> 메시징(Messaging)</h2> <p><strong>Lists</strong></p> <ul><li>Blocking 기능을 이용해 Event Queue로 사용</li> <li>키가 있을 때만 데이터 저장 가능 - LPUSHX / RPUSHX
<ul><li><strong>이미 캐싱되어 있는 피드</strong>에만 신규 트윗을 저장</li> <li>비효율적인 데이터의 이동을 막을 수 있다.</li></ul></li></ul> <p><strong>Streams</strong></p> <ul><li>로그를 저장하기 가장 적절한 자료구조</li> <li>append-only</li> <li>시간 범위로 검색/ 신규추가 데이터 수신/ 소비자별 다른 데이터 수신(소비자 그룹)</li></ul> <h1 id="운영"><a href="#운영" class="header-anchor">#</a> 운영</h1> <h2 id="redis에서-데이터를-영구저장하는-방법"><a href="#redis에서-데이터를-영구저장하는-방법" class="header-anchor">#</a> Redis에서 데이터를 영구저장하는 방법?</h2> <h3 id="redis는-in-memory-데이터-스토어"><a href="#redis는-in-memory-데이터-스토어" class="header-anchor">#</a> Redis는 In-memory 데이터 스토어</h3> <ul><li>서버 재시작 시 모든 데이터 유실</li> <li>복제 기능을 사용해도 사람의 실수 발생 시 데이터 복원 불가</li> <li>Redis를 캐시 이외의 용도로 사용한다면 적절한 데이터 백업이 필요</li></ul> <h3 id="redis-persistence-option"><a href="#redis-persistence-option" class="header-anchor">#</a> Redis Persistence Option</h3> <ul><li>RDB(snapshot)
<ul><li>자동: redis.conf 파일에서 SAVE 옵션</li> <li>수동: BGSAVE 커멘드를 이용해 cli 창에서 수동으로 RDB 파일 저장
<ul><li>SAVE 커멘드는 사용 X</li></ul></li></ul></li> <li>AOF(Append Only File)
<ul><li>자동: redis.conf 파일에서 auto-aof-rewrite-percentage 옵션</li> <li>수동: BGREWRITEAOF 커멘드를 이용해 CLI 창에서 수동으로 AOF 파일 재작성</li></ul></li></ul> <h2 id="rdb-vs-aof-선택-기준"><a href="#rdb-vs-aof-선택-기준" class="header-anchor">#</a> RDB vs AOF 선택 기준</h2> <ul><li>백업은 필요하지만 어느 정도 데이터 손실이 발생해도 괜찮은 경우
<ul><li>RDB 단독 사용</li> <li>redis.conf 파일에서 SAVE 옵션 적절히 사용</li></ul></li> <li>장애 상황 직전까지의 모든 데이터가 보장되어야 할 경우
<ul><li>AOF 사용
<ul><li>APPENDFSYNC 옵션이 everysec인 경우 최대 1초 사이의 데이터 유실 가능</li></ul></li></ul></li> <li>제일 강력한 내구성 필요시</li> <li>RDB, AOF 동시 사용</li></ul> <h2 id="redis-아키텍처의-종류"><a href="#redis-아키텍처의-종류" class="header-anchor">#</a> Redis 아키텍처의 종류</h2> <ul><li><p>Replication</p> <ul><li>단순 복제 연결</li> <li>비동기식 복제</li> <li>HA 기능이 없으므로 장애시 수동 복구</li></ul></li> <li><p>Sentinel</p> <ul><li>자동 페일오버 가능한 HA 구성(High Availability)</li> <li>Sentinel 노드가 다른 노드를 감시</li> <li>마스터가 비정상 상태일 때 자동으로 페일오버</li> <li>연결 정보 변경 필요 없음</li> <li>Sentinel 노드는 항상 3대 이상의 홀수로 존재해야 함</li></ul></li> <li><p>Cluster</p> <ul><li>스케일 아웃과 HA 구성</li> <li>키를 여러 노드로 자동 분할 저장(샤딩)</li> <li>모든 노드가 서로를 감시하며, 마스터가 비정상 상태일 때 자동 페일오버</li> <li>최소 3대의 마스터 노드 필요</li></ul></li></ul> <h2 id="사용하지-말아야할-커멘트"><a href="#사용하지-말아야할-커멘트" class="header-anchor">#</a> 사용하지 말아야할 커멘트</h2> <h3 id="주의-redis는-single-thread로-동작"><a href="#주의-redis는-single-thread로-동작" class="header-anchor">#</a> 주의: Redis는 Single Thread로 동작</h3> <ul><li>keys * -&gt; scan으로 대체</li> <li>Hash나 Sorted Set 등 자료구조
<ul><li>키 나누기(최대 100만개)</li> <li>hgetall -&gt; hscan</li> <li>del -&gt; unlink</li></ul></li></ul> <h2 id="변경하면-장애를-막을-수-있는-기본-설정값"><a href="#변경하면-장애를-막을-수-있는-기본-설정값" class="header-anchor">#</a> 변경하면 장애를 막을 수 있는 기본 설정값</h2> <p><strong>STOP-WRITES-ON-BGSAVE-ERROR = NO</strong></p> <ul><li>yes(default)</li> <li>RDB 파일 저장 실패 시 redis로의 모든 write 불가능</li></ul> <p><strong>MAXMEMORY-POLICY = ALLKEYS-LRU</strong></p> <ul><li>redis를 캐시로 사용할 때 Expire Time 설정 권장</li> <li>메모리가 가득 찼을 때 MAXMEMORY-POLICY 정책에 의해 키 관리
<ul><li>noeviction(default): 삭제 안함</li> <li>volatile-lru</li> <li>allkeys-lru</li></ul></li></ul> <h2 id="cache-stamped-현상"><a href="#cache-stamped-현상" class="header-anchor">#</a> Cache Stamped 현상</h2> <ul><li>TTL 값을 너무 작게 설정한 경우</li></ul> <h2 id="maxmemory-값-설정"><a href="#maxmemory-값-설정" class="header-anchor">#</a> MaxMemory 값 설정</h2> <p><strong>Persistence / 복제 사용시 MaxMemory 설정 주의</strong></p> <ul><li>RDB 저장 &amp; AOF rewrite 시 fork()</li> <li>Copy-on-Write로 인해 메모리를 두배로 사용하는 경우 발생 가능</li> <li>Persistence / 복제 사용시 MaxMemory는 실제 메모리의 절반으로 설정</li></ul> <h2 id="memory-관리"><a href="#memory-관리" class="header-anchor">#</a> Memory 관리</h2> <p><strong>물리적으로 사용되고 있는 메모리를 모니터링</strong></p> <ul><li>used_memory: 논리적으로 redis가 사용하는 메모리</li> <li>used_memory_rss: OS가 redis에 할당하기 위해 사용하는 물리적 메모리 양</li> <li>삭제되는 키가 많으면 fragmentation 증가
<ul><li>특정 시점에 피크를 찍고 다시 삭제되는 경우</li> <li>TTL로 인한 eviction이 많이 발생하는 경우</li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/TIL/Database/mysql.html" class="prev">
        MySQL
      </a></span> <span class="next"><a href="/TIL/Vuepress/vuepress-quick-start.html">
        Vuepress 블로그 만들기
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/TIL/assets/js/app.dc1d7481.js" defer></script><script src="/TIL/assets/js/2.24238b2e.js" defer></script><script src="/TIL/assets/js/16.d2238131.js" defer></script>
  </body>
</html>
